<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Pasapalabra - SHOW (Responsive)</title>
<style>
  :root{
    --pending:#2a335c;
    --active:#ffd166;
    --ok:#06d6a0;
    --bad:#ef476f;

    --text:#eef2ff;

    /* CHROMA (verde brillante sólido) */
    --chroma:#00ff00;

    /* Si quieres el “hueco” también verde para cámara/chroma */
    --holeBg: var(--chroma);
  }

  *{ box-sizing:border-box; font-family:system-ui,Segoe UI,Roboto,Arial; }

  html,body{
    width:100%;
    height:100%;
    margin:0;
    background:var(--chroma); /* FONDO VERDE */
    overflow:hidden;
  }

  /* El escenario ocupa toda la pantalla */
  .stage{
    width:100vw;
    height:100vh;
    background:var(--chroma); /* FONDO VERDE */
    display:flex;
    align-items:center;
    justify-content:center;
  }

  /* “Lienzo” 16:9 que se escala a cualquier pantalla */
  .canvas{
    width:100%;
    height:100%;
    aspect-ratio: 16 / 9;
    max-width: 100vw;
    max-height: 100vh;

    /* centrar */
    display:flex;
    flex-direction:column;
    gap:18px;

    padding: clamp(14px, 1.8vw, 28px);
  }

  /* Barra superior */
.top{
  display:flex;
  gap: clamp(8px, .8vw, 14px);
  align-items:center;
}


  .clue{
    flex:1.5;
    background:rgba(0,0,0,.25);
    border:2px solid rgba(255,255,255,.22);
    border-radius:20px;
     padding: clamp(8px, .9vw, 12px);
  min-height: clamp(64px, 7vh, 96px);
    color:var(--text);
  }
  .clue .lbl{
    margin:0 0 8px 0;
    font-size: clamp(12px, 1.2vw, 16px);
    opacity:.95;
  }
  .clue .txt{
    margin:0;
    font-weight:900;
    line-height:1.12;
     font-size: clamp(18px, 1.9vw, 28px);
    text-shadow: 0 3px 10px rgba(0,0,0,.25);
  }

  .stats{
    display:flex;
    gap: clamp(10px, 1.2vw, 14px);
  }

  .stat{
    width: clamp(120px, 8vw, 100px);
    background:rgba(0,0,0,.22);
    border:2px solid rgba(255,255,255,.22);
    border-radius:20px;
    padding: clamp(10px, 1vw, 16px);
    display:flex;
    flex-direction:column;
    justify-content:center;
    color:var(--text);
  }
  .stat b{
    font-size: clamp(22px, 2.4vw, 38px);
    line-height:1;
  }
  .stat span{
    font-size: clamp(12px, 1.1vw, 15px);
    margin-top:6px;
    opacity:.95;
  }

  /* Zona del rosco ocupa el resto */
  .roscoWrap{
     flex:1.5; 
    min-height:0;
    display:flex;
    align-items:center;
    justify-content:center;
  }

  .rosco{
    position:relative;

    /* Tamaño responsive: se adapta al espacio disponible */
    width: min(90vh, 70vw);
  height: min(90vh, 50vw);

  }

  .hole{
    position:absolute;
    inset: 18%;
    border-radius:999px;
    background: var(--holeBg); /* verde sólido */
    pointer-events:none;
  }

  .letter{
    position:absolute;
    width: clamp(30px, 4.2vw, 50px);
    height:clamp(30px, 4.2vw, 50px);
    border-radius:999px;
    display:flex;
    align-items:center;
    justify-content:center;
    font-weight:900;

    font-size: clamp(16px, 1.7vw, 26px);

    background:var(--pending);
    border:2px solid rgba(255,255,255,.18);
    color:#fff;
    user-select:none;
    transition:transform .12s ease, background .2s ease, box-shadow .2s ease;
  }

  .letter.active{
    background:var(--active);
    color:#222;
    box-shadow:0 0 0 12px rgba(255,209,102,.22);
    transform:scale(1.12);
  }
  .letter.ok{ background:var(--ok); color:#062b1f; }
  .letter.bad{ background:var(--bad); }

  /* En pantallas muy angostas, apila stats abajo */
  @media (max-aspect-ratio: 16/10){
    .top{ flex-wrap:wrap; }
    .stats{ width:100%; justify-content:flex-end; }
  }
</style>
</head>

<body>
<div class="stage">
  <div class="canvas">

    <div class="top">
      <div class="clue">
        <p class="lbl" id="showTitle">Letra: —</p>
        <p class="txt" id="showClue">Abre el panel de control y pulsa “Iniciar”.</p>
      </div>

      <div class="stats">
        <div class="stat"><b id="time">00:00</b><span>Tiempo</span></div>
        <div class="stat"><b id="ok">0</b><span>Acertadas</span></div>
        <div class="stat"><b id="bad">0</b><span>Falladas</span></div>
        <div class="stat"><b id="pending">0</b><span>Pendientes</span></div>
      </div>
    </div>

    <div class="roscoWrap">
      <div class="rosco" id="rosco">
        <div class="hole"></div>
      </div>
    </div>

  </div>

  <div id="banner" style="
  position:fixed; inset:0;
  display:none;
  align-items:center; justify-content:center;
  background:rgba(0,0,0,.55);
  color:#fff;
  font-weight:900;
  font-size:clamp(28px,4vw,64px);
  text-align:center;
  z-index:9999;
">
  <div id="bannerText" style="
    padding:22px 28px;
    border-radius:22px;
    border:2px solid rgba(255,255,255,.35);
    background:rgba(0,0,0,.35);
  ">Ronda terminada</div>
</div>

</div>

<script>
  const KEY = "PASAPALABRA_STATE_V1";

  const els = {
    rosco: document.getElementById("rosco"),
    showTitle: document.getElementById("showTitle"),
    showClue: document.getElementById("showClue"),
    time: document.getElementById("time"),
    ok: document.getElementById("ok"),
    bad: document.getElementById("bad"),
    pending: document.getElementById("pending"),
  };

  function safeParse(json, fallback){ try{return JSON.parse(json);}catch{return fallback;} }

  function buildRosco(items){
    [...els.rosco.querySelectorAll(".letter")].forEach(n=>n.remove());

    const w = els.rosco.clientWidth;
    const h = els.rosco.clientHeight;
    const cx = w/2, cy = h/2;
    const radius = Math.min(w,h)/2 - (Math.min(w,h) * 0.10);

    const n = items.length;
    for (let i=0;i<n;i++){
      const angle = (Math.PI*2)*(i/n) - Math.PI/2;
      const x = cx + radius*Math.cos(angle);
      const y = cy + radius*Math.sin(angle);

      const div = document.createElement("div");
      div.className = "letter pending";
      div.textContent = items[i].letter;
      div.style.left = (x - divSize()/2) + "px";
      div.style.top  = (y - divSize()/2) + "px";
      div.dataset.idx = String(i);
      els.rosco.appendChild(div);
    }
  }

  // tamaño aproximado del círculo (para centrar bien)
  function divSize(){
    // igual al clamp de CSS, pero aprox con viewport
    // 4.2vw en un canvas 16:9 tiende a funcionar bien
    const v = Math.min(window.innerWidth, window.innerHeight);
    return Math.max(40, Math.min(68, v * 0.065));
  }

  function updateRosco(state){
    const nodes = [...els.rosco.querySelectorAll(".letter")];
    nodes.forEach(n=>{
      const i = Number(n.dataset.idx);
      const it = state.items[i];
      n.classList.remove("pending","ok","bad","active");
      n.classList.add(it?.status || "pending");
      if (i === state.currentIndex) n.classList.add("active");
    });
  }

  function render(state){
    if (!state || !Array.isArray(state.items)) return;

    const cur = state.items[state.currentIndex] || {};
    els.showTitle.textContent = `Letra: ${cur.letter ?? "—"}${state.currentSetName ? " · " + state.currentSetName : ""}`;
    els.showClue.textContent  = cur.clue ?? "—";

    els.time.textContent = state.timeStr ?? "00:00";
    els.ok.textContent = String(state.stats?.ok ?? 0);
    els.bad.textContent = String(state.stats?.bad ?? 0);
    els.pending.textContent = String(state.stats?.pending ?? 0);

    // Rebuild si cambió cantidad o si aún no existe
    if (!els.rosco.dataset.built || els.rosco.dataset.count !== String(state.items.length)){
      buildRosco(state.items);
      els.rosco.dataset.built = "1";
      els.rosco.dataset.count = String(state.items.length);
    }
    updateRosco(state);

    const b = document.getElementById("banner");
const bt = document.getElementById("bannerText");
if (state?.gameOver && state?.banner){
  bt.textContent = state.banner;
  b.style.display = "flex";
} else {
  b.style.display = "none";
}

  }

  function readAndRender(){
    const raw = localStorage.getItem(KEY);
    render(safeParse(raw, null));
  }

  // si cambias el tamaño de ventana, hay que recalcular posiciones
  window.addEventListener("resize", ()=>{
    els.rosco.dataset.built = "";
    readAndRender();
  });

  window.addEventListener("storage", (e)=>{ if (e.key === KEY) readAndRender(); });
  setInterval(readAndRender, 250);
  readAndRender();
</script>
</body>
</html>
